shadow$provide.module$node_modules$send$index=function(global,require,module,exports){function SendStream(req,path,options){Stream.call(this);this.options=options=options||{};this.path=path;this.req=req;this._acceptRanges=void 0!==options.acceptRanges?!!options.acceptRanges:!0;this._cacheControl=void 0!==options.cacheControl?!!options.cacheControl:!0;this._etag=void 0!==options.etag?!!options.etag:!0;this._dotfiles=void 0!==options.dotfiles?options.dotfiles:"ignore";if("ignore"!==this._dotfiles&&
"allow"!==this._dotfiles&&"deny"!==this._dotfiles)throw new TypeError('dotfiles option must be "allow", "deny", or "ignore"');this._hidden=!!options.hidden;void 0!==options.hidden&&deprecate("hidden: use dotfiles: '"+(this._hidden?"allow":"ignore")+"' instead");void 0===options.dotfiles&&(this._dotfiles=void 0);this._extensions=void 0!==options.extensions?normalizeList(options.extensions,"extensions option"):[];this._immutable=void 0!==options.immutable?!!options.immutable:!1;this._index=void 0!==
options.index?normalizeList(options.index,"index option"):["index.html"];this._lastModified=void 0!==options.lastModified?!!options.lastModified:!0;this._maxage=options.maxAge||options.maxage;this._maxage="string"===typeof this._maxage?ms(this._maxage):Number(this._maxage);this._maxage=isNaN(this._maxage)?0:Math.min(Math.max(0,this._maxage),31536E6);this._root=options.root?resolve(options.root):null;!this._root&&options.from&&this.from(options.from)}function contentRange(type,size,range){return type+
" "+(range?range.start+"-"+range.end:"*")+"/"+size}function createHtmlDocument(title,body){return'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\x3chead\x3e\n\x3cmeta charset\x3d"utf-8"\x3e\n\x3ctitle\x3e'+title+"\x3c/title\x3e\n\x3c/head\x3e\n\x3cbody\x3e\n\x3cpre\x3e"+body+"\x3c/pre\x3e\n\x3c/body\x3e\n\x3c/html\x3e\n"}function getHeaderNames(res){return"function"!==typeof res.getHeaderNames?Object.keys(res._headers||{}):res.getHeaderNames()}function hasListeners(emitter,type){return 0<("function"!==
typeof emitter.listenerCount?emitter.listeners(type).length:emitter.listenerCount(type))}function normalizeList(val,name){val=[].concat(val||[]);for(var i=0;i<val.length;i++)if("string"!==typeof val[i])throw new TypeError(name+" must be array of strings or false");return val}function parseHttpDate(date){date=date&&Date.parse(date);return"number"===typeof date?date:NaN}function parseTokenList(str){for(var end=0,list=[],start=0,i=0,len=str.length;i<len;i++)switch(str.charCodeAt(i)){case 32:start===
end&&(start=end=i+1);break;case 44:list.push(str.substring(start,end));start=end=i+1;break;default:end=i+1}list.push(str.substring(start,end));return list}var Buffer=require("module$node_modules$buffer$index").Buffer;"use strict";var createError=require("module$node_modules$http_errors$index"),debug=require("module$node_modules$debug$src$browser")("send"),deprecate=require("module$node_modules$depd$lib$browser$index")("send"),destroy=require("module$node_modules$destroy$index"),encodeUrl=require("module$node_modules$encodeurl$index"),
escapeHtml=require("module$node_modules$escape_html$index"),etag$jscomp$0=require("module$node_modules$etag$index"),fresh=require("module$node_modules$fresh$index"),fs=require("shadow$empty"),mime=require("module$node_modules$mime$mime"),ms=require("module$node_modules$ms$index"),onFinished=require("module$node_modules$on_finished$index"),parseRange=require("module$node_modules$range_parser$index");global=require("module$node_modules$path_browserify$index");var statuses=require("module$node_modules$statuses$index"),
Stream=require("module$node_modules$stream_browserify$index");require=require("module$node_modules$util$util");var extname=global.extname,join=global.join,normalize=global.normalize,resolve=global.resolve,sep=global.sep,BYTES_RANGE_REGEXP=/^ *bytes=/,UP_PATH_REGEXP=/(?:^|[\\/])\.\.(?:[\\/]|$)/;module.exports=function(req,path,options){return new SendStream(req,path,options)};module.exports.mime=mime;require.inherits(SendStream,Stream);SendStream.prototype.etag=deprecate.function(function(val){this._etag=
!!val;debug("etag %s",this._etag);return this},"send.etag: pass etag as option");SendStream.prototype.hidden=deprecate.function(function(val){this._hidden=!!val;this._dotfiles=void 0;debug("hidden %s",this._hidden);return this},"send.hidden: use dotfiles option");SendStream.prototype.index=deprecate.function(function(paths){var index=paths?normalizeList(paths,"paths argument"):[];debug("index %o",paths);this._index=index;return this},"send.index: pass index as option");SendStream.prototype.root=function(path){this._root=
resolve(String(path));debug("root %s",this._root);return this};SendStream.prototype.from=deprecate.function(SendStream.prototype.root,"send.from: pass root as option");SendStream.prototype.root=deprecate.function(SendStream.prototype.root,"send.root: pass root as option");SendStream.prototype.maxage=deprecate.function(function(maxAge){this._maxage="string"===typeof maxAge?ms(maxAge):Number(maxAge);this._maxage=isNaN(this._maxage)?0:Math.min(Math.max(0,this._maxage),31536E6);debug("max-age %d",this._maxage);
return this},"send.maxage: pass maxAge as option");SendStream.prototype.error=function(status,err){if(hasListeners(this,"error"))return this.emit("error",createError(status,err,{expose:!1}));for(var res=this.res,doc=createHtmlDocument("Error",escapeHtml(statuses[status]||String(status))),headers=getHeaderNames(res),i=0;i<headers.length;i++)res.removeHeader(headers[i]);if(err&&err.headers)for(err=err.headers,headers=Object.keys(err),i=0;i<headers.length;i++){var key=headers[i];res.setHeader(key,err[key])}res.statusCode=
status;res.setHeader("Content-Type","text/html; charset\x3dUTF-8");res.setHeader("Content-Length",Buffer.byteLength(doc));res.setHeader("Content-Security-Policy","default-src 'none'");res.setHeader("X-Content-Type-Options","nosniff");res.end(doc)};SendStream.prototype.hasTrailingSlash=function(){return"/"===this.path[this.path.length-1]};SendStream.prototype.isConditionalGET=function(){return this.req.headers["if-match"]||this.req.headers["if-unmodified-since"]||this.req.headers["if-none-match"]||
this.req.headers["if-modified-since"]};SendStream.prototype.isPreconditionFailure=function(){var req=this.req,res=this.res,match$jscomp$0=req.headers["if-match"];if(match$jscomp$0){var etag=res.getHeader("ETag");return!etag||"*"!==match$jscomp$0&&parseTokenList(match$jscomp$0).every(function(match){return match!==etag&&match!=="W/"+etag&&"W/"+match!==etag})}req=parseHttpDate(req.headers["if-unmodified-since"]);return isNaN(req)?!1:(res=parseHttpDate(res.getHeader("Last-Modified")),isNaN(res)||res>
req)};SendStream.prototype.removeContentHeaderFields=function(){for(var res=this.res,headers=getHeaderNames(res),i=0;i<headers.length;i++){var header=headers[i];"content-"===header.substr(0,8)&&"content-location"!==header&&res.removeHeader(header)}};SendStream.prototype.notModified=function(){var res=this.res;debug("not modified");this.removeContentHeaderFields();res.statusCode=304;res.end()};SendStream.prototype.headersAlreadySent=function(){var err=Error("Can't set headers after they are sent.");
debug("headers already sent");this.error(500,err)};SendStream.prototype.isCachable=function(){var statusCode=this.res.statusCode;return 200<=statusCode&&300>statusCode||304===statusCode};SendStream.prototype.onStatError=function(error){switch(error.code){case "ENAMETOOLONG":case "ENOENT":case "ENOTDIR":this.error(404,error);break;default:this.error(500,error)}};SendStream.prototype.isFresh=function(){return fresh(this.req.headers,{etag:this.res.getHeader("ETag"),"last-modified":this.res.getHeader("Last-Modified")})};
SendStream.prototype.isRangeFresh=function(){var ifRange=this.req.headers["if-range"];if(!ifRange)return!0;if(-1!==ifRange.indexOf('"')){var etag=this.res.getHeader("ETag");return!(!etag||-1===ifRange.indexOf(etag))}etag=this.res.getHeader("Last-Modified");return parseHttpDate(etag)<=parseHttpDate(ifRange)};SendStream.prototype.redirect=function(path){var res=this.res;if(hasListeners(this,"directory"))this.emit("directory",res,path);else if(this.hasTrailingSlash())this.error(403);else{path=this.path+
"/";for(var i=0;i<path.length&&"/"===path[i];i++);path=1<i?"/"+path.substr(i):path;path=encodeUrl(path);i=createHtmlDocument("Redirecting",'Redirecting to \x3ca href\x3d"'+escapeHtml(path)+'"\x3e'+escapeHtml(path)+"\x3c/a\x3e");res.statusCode=301;res.setHeader("Content-Type","text/html; charset\x3dUTF-8");res.setHeader("Content-Length",Buffer.byteLength(i));res.setHeader("Content-Security-Policy","default-src 'none'");res.setHeader("X-Content-Type-Options","nosniff");res.setHeader("Location",path);
res.end(i)}};SendStream.prototype.pipe=function(res){var root=this._root;this.res=res;try{var path=decodeURIComponent(this.path)}catch(err){path=-1}if(-1===path||~path.indexOf("\x00"))return this.error(400),res;if(null!==root){path&&(path=normalize("."+sep+path));if(UP_PATH_REGEXP.test(path))return debug('malicious path "%s"',path),this.error(403),res;var parts=path.split(sep);path=normalize(join(root,path))}else{if(UP_PATH_REGEXP.test(path))return debug('malicious path "%s"',path),this.error(403),
res;parts=normalize(path).split(sep);path=resolve(path)}a:{for(root=0;root<parts.length;root++){var part=parts[root];if(1<part.length&&"."===part[0]){root=!0;break a}}root=!1}if(root)switch(root=this._dotfiles,void 0===root&&(root="."===parts[parts.length-1][0]?this._hidden?"allow":"ignore":"allow"),debug('%s dotfile "%s"',root,path),root){case "allow":break;case "deny":return this.error(403),res;default:return this.error(404),res}if(this._index.length&&this.hasTrailingSlash())return this.sendIndex(path),
res;this.sendFile(path);return res};SendStream.prototype.send=function(path,stat){var len=stat.size,options=this.options,opts={},res=this.res,req=this.req,ranges=req.headers.range,offset=options.start||0;if("boolean"!==typeof res.headersSent?res._header:res.headersSent)this.headersAlreadySent();else{debug('pipe "%s"',path);this.setHeader(path,stat);this.type(path);if(this.isConditionalGET()){if(this.isPreconditionFailure()){this.error(412);return}if(this.isCachable()&&this.isFresh()){this.notModified();
return}}len=Math.max(0,len-offset);void 0!==options.end&&(stat=options.end-offset+1,len>stat&&(len=stat));if(this._acceptRanges&&BYTES_RANGE_REGEXP.test(ranges)){ranges=parseRange(len,ranges,{combine:!0});this.isRangeFresh()||(debug("range stale"),ranges=-2);if(-1===ranges)return debug("range unsatisfiable"),res.setHeader("Content-Range",contentRange("bytes",len)),this.error(416,{headers:{"Content-Range":res.getHeader("Content-Range")}});-2!==ranges&&1===ranges.length&&(debug("range %j",ranges),res.statusCode=
206,res.setHeader("Content-Range",contentRange("bytes",len,ranges[0])),offset+=ranges[0].start,len=ranges[0].end-ranges[0].start+1)}for(var prop in options)opts[prop]=options[prop];opts.start=offset;opts.end=Math.max(offset,offset+len-1);res.setHeader("Content-Length",len);"HEAD"===req.method?res.end():this.stream(path,opts)}};SendStream.prototype.sendFile=function(path){function next(err$jscomp$0){if(self._extensions.length<=i)return err$jscomp$0?self.onStatError(err$jscomp$0):self.error(404);var p=
path+"."+self._extensions[i++];debug('stat "%s"',p);fs.stat(p,function(err,stat){if(err)return next(err);if(stat.isDirectory())return next();self.emit("file",p,stat);self.send(p,stat)})}var i=0,self=this;debug('stat "%s"',path);fs.stat(path,function(err,stat){if(err&&"ENOENT"===err.code&&!extname(path)&&path[path.length-1]!==sep)return next(err);if(err)return self.onStatError(err);if(stat.isDirectory())return self.redirect(path);self.emit("file",path,stat);self.send(path,stat)})};SendStream.prototype.sendIndex=
function(path){function next(err$jscomp$0){if(++i>=self._index.length)return err$jscomp$0?self.onStatError(err$jscomp$0):self.error(404);var p=join(path,self._index[i]);debug('stat "%s"',p);fs.stat(p,function(err,stat){if(err)return next(err);if(stat.isDirectory())return next();self.emit("file",p,stat);self.send(p,stat)})}var i=-1,self=this;next()};SendStream.prototype.stream=function(path,options){var finished=!1,self=this,res=this.res,stream=fs.createReadStream(path,options);this.emit("stream",
stream);stream.pipe(res);onFinished(res,function(){finished=!0;destroy(stream)});stream.on("error",function(err){finished||(finished=!0,destroy(stream),self.onStatError(err))});stream.on("end",function(){self.emit("end")})};SendStream.prototype.type=function(path){var res=this.res;if(!res.getHeader("Content-Type"))if(path=mime.lookup(path)){var charset=mime.charsets.lookup(path);debug("content-type %s",path);res.setHeader("Content-Type",path+(charset?"; charset\x3d"+charset:""))}else debug("no content-type")};
SendStream.prototype.setHeader=function(path,stat){var res=this.res;this.emit("headers",res,path,stat);this._acceptRanges&&!res.getHeader("Accept-Ranges")&&(debug("accept ranges"),res.setHeader("Accept-Ranges","bytes"));this._cacheControl&&!res.getHeader("Cache-Control")&&(path="public, max-age\x3d"+Math.floor(this._maxage/1E3),this._immutable&&(path+=", immutable"),debug("cache-control %s",path),res.setHeader("Cache-Control",path));this._lastModified&&!res.getHeader("Last-Modified")&&(path=stat.mtime.toUTCString(),
debug("modified %s",path),res.setHeader("Last-Modified",path));this._etag&&!res.getHeader("ETag")&&(stat=etag$jscomp$0(stat),debug("etag %s",stat),res.setHeader("ETag",stat))}}
//# sourceMappingURL=module$node_modules$send$index.js.map
