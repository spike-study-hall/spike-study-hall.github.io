shadow$provide.module$node_modules$on_finished$index=function(global,require,module,exports){function isFinished(msg){var socket=msg.socket;if("boolean"===typeof msg.finished)return!!(msg.finished||socket&&!socket.writable);if("boolean"===typeof msg.complete)return!(!msg.upgrade&&socket&&socket.readable&&(!msg.complete||msg.readable))}function attachFinishedListener(msg,callback){function onFinish(error){eeMsg.cancel();eeSocket.cancel();finished=!0;callback(error)}function onSocket(socket){msg.removeListener("socket",
onSocket);finished||eeMsg===eeSocket&&(eeSocket=first([[socket,"error","close"]],onFinish))}var eeSocket,finished=!1;var eeMsg=eeSocket=first([[msg,"end","finish"]],onFinish);msg.socket?onSocket(msg.socket):(msg.on("socket",onSocket),void 0===msg.socket&&patchAssignSocket(msg,onSocket))}function createListener(msg){function listener(err){msg.__onFinished===listener&&(msg.__onFinished=null);if(listener.queue){var queue=listener.queue;listener.queue=null;for(var i=0;i<queue.length;i++)queue[i](err,
msg)}}listener.queue=[];return listener}function patchAssignSocket(res,callback){var assignSocket=res.assignSocket;"function"===typeof assignSocket&&(res.assignSocket=function(socket){assignSocket.call(this,socket);callback(socket)})}var process=require("module$node_modules$process$browser");"use strict";module.exports=function(msg,listener){if(!1!==isFinished(msg))return defer(listener,null,msg),msg;var attached=msg.__onFinished;attached&&attached.queue||(attached=msg.__onFinished=createListener(msg),
attachFinishedListener(msg,attached));attached.queue.push(listener);return msg};module.exports.isFinished=isFinished;var first=require("module$node_modules$ee_first$index"),defer="function"===typeof setImmediate?setImmediate:function(fn){process.nextTick(fn.bind.apply(fn,arguments))}}
//# sourceMappingURL=module$node_modules$on_finished$index.js.map
