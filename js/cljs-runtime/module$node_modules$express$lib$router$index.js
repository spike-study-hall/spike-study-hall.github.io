shadow$provide.module$node_modules$express$lib$router$index=function(global,require,module,exports){function appendMethods(list,addition){for(var i=0;i<addition.length;i++){var method=addition[i];-1===list.indexOf(method)&&list.push(method)}}function getProtohost(url){if("string"===typeof url&&0!==url.length&&"/"!==url[0]){var searchIndex=url.indexOf("?");searchIndex=url.substr(0,-1!==searchIndex?searchIndex:url.length).indexOf("://");return-1!==searchIndex?url.substr(0,url.indexOf("/",3+searchIndex)):
void 0}}function mergeParams(params,parent){if("object"!==typeof parent||!parent)return params;var obj=mixin({},parent);if(!(0 in params&&0 in parent))return mixin(obj,params);for(var i=0,o=0;i in params;)i++;for(;o in parent;)o++;for(i--;0<=i;i--)params[i+o]=params[i],i<o&&delete params[i];return mixin(obj,params)}function restore(fn,obj){for(var props=Array(arguments.length-2),vals=Array(arguments.length-2),i$jscomp$0=0;i$jscomp$0<props.length;i$jscomp$0++)props[i$jscomp$0]=arguments[i$jscomp$0+
2],vals[i$jscomp$0]=obj[props[i$jscomp$0]];return function(){for(var i=0;i<props.length;i++)obj[props[i]]=vals[i];return fn.apply(this,arguments)}}function wrap(old,fn){return function(){var args=Array(arguments.length+1);args[0]=old;for(var i=0,len=arguments.length;i<len;i++)args[i+1]=arguments[i];fn.apply(this,args)}}var Route=require("module$node_modules$express$lib$router$route"),Layer=require("module$node_modules$express$lib$router$layer");global=require("module$node_modules$methods$index");
var mixin=require("module$node_modules$utils_merge$index"),debug=require("module$node_modules$debug$src$browser")("express:router"),deprecate=require("module$node_modules$depd$lib$browser$index")("express"),flatten=require("module$node_modules$array_flatten$array_flatten"),parseUrl=require("module$node_modules$parseurl$index"),setPrototypeOf=require("module$node_modules$setprototypeof$index"),objectRegExp=/^\[object (\S+)\]$/,slice=Array.prototype.slice,toString=Object.prototype.toString,proto=module.exports=
function(options){function router(req,res,next){router.handle(req,res,next)}options=options||{};setPrototypeOf(router,proto);router.params={};router._params=[];router.caseSensitive=options.caseSensitive;router.mergeParams=options.mergeParams;router.strict=options.strict;router.stack=[];return router};proto.param=function(name,fn){if("function"===typeof name)deprecate("router.param(fn): Refactor to use path params"),this._params.push(name);else{var params=this._params,len=params.length,ret;":"===name[0]&&
(deprecate("router.param("+JSON.stringify(name)+", fn): Use router.param("+JSON.stringify(name.substr(1))+", fn) instead"),name=name.substr(1));for(var i=0;i<len;++i)if(ret=params[i](name,fn))fn=ret;if("function"!==typeof fn)throw Error("invalid param() call for "+name+", got "+fn);(this.params[name]=this.params[name]||[]).push(fn);return this}};proto.handle=function(req,res,out){function next(err$jscomp$0){var layerError="route"===err$jscomp$0?null:err$jscomp$0;slashAdded&&(req.url=req.url.substr(1),
slashAdded=!1);0!==removed.length&&(req.baseUrl=parentUrl,req.url=protohost+removed+req.url.substr(protohost.length),removed="");if("router"===layerError)setImmediate(done,null);else if(idx>=stack.length)setImmediate(done,layerError);else{try{var path=parseUrl(req).pathname}catch(err){path=void 0}if(null==path)return done(layerError);for(var layer,match,route;!0!==match&&idx<stack.length;){layer=stack[idx++];try{match=layer.match(path)}catch(err){match=err}route=layer.route;"boolean"!==typeof match&&
(layerError=layerError||match);if(!0===match&&route)if(layerError)match=!1;else{err$jscomp$0=req.method;var has_method=route._handles_method(err$jscomp$0);has_method||"OPTIONS"!==err$jscomp$0||appendMethods(options,route._options());has_method||"HEAD"===err$jscomp$0||(match=!1)}}if(!0!==match)return done(layerError);route&&(req.route=route);req.params=self.mergeParams?mergeParams(layer.params,parentParams):layer.params;var layerPath=layer.path;self.process_params(layer,paramcalled,req,res,function(err){if(err)return next(layerError||
err);if(route)return layer.handle_request(req,res,next);a:{err=layer;var layerError$jscomp$0=layerError;if(0!==layerPath.length){var c=path[layerPath.length];if(c&&"/"!==c&&"."!==c){next(layerError$jscomp$0);break a}debug("trim prefix (%s) from url %s",layerPath,req.url);removed=layerPath;req.url=protohost+req.url.substr(protohost.length+removed.length);protohost||"/"===req.url[0]||(req.url="/"+req.url,slashAdded=!0);req.baseUrl=parentUrl+("/"===removed[removed.length-1]?removed.substring(0,removed.length-
1):removed)}debug("%s %s : %s",err.name,layerPath,req.originalUrl);layerError$jscomp$0?err.handle_error(layerError$jscomp$0,req,res,next):err.handle_request(req,res,next)}})}}var self=this;debug("dispatching %s %s",req.method,req.url);var idx=0,protohost=getProtohost(req.url)||"",removed="",slashAdded=!1,paramcalled={},options=[],stack=self.stack,parentParams=req.params,parentUrl=req.baseUrl||"",done=restore(out,req,"baseUrl","next","params");req.next=next;"OPTIONS"===req.method&&(done=wrap(done,
function(old,err$jscomp$0){if(err$jscomp$0||0===options.length)return old(err$jscomp$0);try{var body=options.join(",");res.set("Allow",body);res.send(body)}catch(err){old(err)}}));req.baseUrl=parentUrl;req.originalUrl=req.originalUrl||req.url;next()};proto.process_params=function(layer,called,req,res,done){function param(err){if(err)return done(err);if(i>=keys.length)return done();paramIndex=0;key=keys[i++];name=key.name;paramVal=req.params[name];paramCallbacks=params[name];paramCalled=called[name];
if(void 0===paramVal||!paramCallbacks)return param();if(paramCalled&&(paramCalled.match===paramVal||paramCalled.error&&"route"!==paramCalled.error))return req.params[name]=paramCalled.value,param(paramCalled.error);called[name]=paramCalled={error:null,match:paramVal,value:paramVal};paramCallback()}function paramCallback(err){var fn=paramCallbacks[paramIndex++];paramCalled.value=req.params[key.name];if(err)paramCalled.error=err,param(err);else{if(!fn)return param();try{fn(req,res,paramCallback,paramVal,
key.name)}catch(e){paramCallback(e)}}}var params=this.params,keys=layer.keys;if(!keys||0===keys.length)return done();var i=0,name,paramIndex=0,key,paramVal,paramCallbacks,paramCalled;param()};proto.use=function(fn){var offset=0,path="/";if("function"!==typeof fn){for(var arg=fn;Array.isArray(arg)&&0!==arg.length;)arg=arg[0];"function"!==typeof arg&&(offset=1,path=fn)}offset=flatten(slice.call(arguments,offset));if(0===offset.length)throw new TypeError("Router.use() requires a middleware function");
for(arg=0;arg<offset.length;arg++){fn=offset[arg];if("function"!==typeof fn)throw path=TypeError,offset=typeof fn,offset="object"!==offset?offset:toString.call(fn).replace(objectRegExp,"$1"),new path("Router.use() requires a middleware function but got a "+offset);debug("use %o %s",path,fn.name||"\x3canonymous\x3e");var layer=new Layer(path,{sensitive:this.caseSensitive,strict:!1,end:!1},fn);layer.route=void 0;this.stack.push(layer)}return this};proto.route=function(path){var route=new Route(path);
path=new Layer(path,{sensitive:this.caseSensitive,strict:this.strict,end:!0},route.dispatch.bind(route));path.route=route;this.stack.push(path);return route};global.concat("all").forEach(function(method){proto[method]=function(path){var route=this.route(path);route[method].apply(route,slice.call(arguments,1));return this}})}
//# sourceMappingURL=module$node_modules$express$lib$router$index.js.map
